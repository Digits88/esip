prefix = @prefix@
exec_prefix = @exec_prefix@
BINDIR = @bindir@
LOGDIR = @localstatedir@/log/esip
DBDIR = @localstatedir@/lib/esip
ESIPDIR = @ERLANG_LIB_DIR@/esip-@PACKAGE_VERSION@
BEAMDIR = $(ESIPDIR)/ebin
BEAMAPPDIR = $(BEAMDIR)/apps
ESIPEXAMPLEDIR = $(ESIPDIR)/examples
INCLUDEDIR = $(ESIPDIR)/include
PRIVDIR = $(ESIPDIR)/priv
SODIR = $(PRIVDIR)/lib
ERL_INTERFACE_DIR = @ERLANG_LIB_DIR_erl_interface@
CC = @CC@
CFLAGS = @CFLAGS@
CPPFLAGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@
ERLANG_CFLAGS = -I $(ERL_INTERFACE_DIR)/include -I @ERLANG_ROOT_DIR@/usr/include
ERLANG_LIBS = -L$(ERL_INTERFACE_DIR)/lib -lerl_interface -lei

# Assume Linux-style dynamic library flags
DYNAMIC_LIB_CFLAGS = -fpic -shared
ifeq ($(shell uname),Darwin)
    DYNAMIC_LIB_CFLAGS = -fPIC -bundle -flat_namespace -undefined suppress
endif
ifeq ($(shell uname),SunOs)
    DYNAMIC_LIB_CFLAGS = -KPIC -G -z text
endif

src: beams

beams:
	@ERL@ -noinput +B -eval \
	'case make:all() of up_to_date -> halt(0); error -> halt(1) end.'

all: src

clean: 
	rm -rf ebin/*.beam
	rm -rf ebin/examples/*.beam
	rm -f erl_crash.dump
	rm -rf *.tmp
	rm -rf *.so

distclean: clean
	rm -rf autom4te.cache
	rm -f config.status
	rm -rf *.log
	rm -f Makefile
	rm -f ebin/esip.app

install:
	install -d $(BEAMDIR)
	install -d $(BEAMAPPDIR)
	install -m 644 ebin/*.app $(BEAMDIR)
	install -m 644 ebin/*.beam $(BEAMDIR)
	install -d $(INCLUDEDIR)
	install -m 644 include/*.hrl $(INCLUDEDIR)
	install -d $(SODIR)
#install -m 755 *.so $(SODIR)

uninstall:
	rm -rf $(ESIPDIR)
